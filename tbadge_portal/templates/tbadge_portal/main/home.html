{% extends "tbadge_portal/base.html" %}

{% load staticfiles %}

{% block title %}
    <title>Temporary Access Badge System - Home</title>
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'tbadge_portal/css/table.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'tbadge_portal/confirm/css/jquery-confirm.css' %}" />
    <style>
    a.issue-ld-badge-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/badge-limited-duration-img.png' %}');
        background-color: #cc7aa2;
        color: #ffffff;
        font-size:1.1em;
    }

    a.issue-ld-badge-panel:hover {
        -webkit-filter: brightness(105%);
        filter: brightness(105%);
        box-shadow: inset 0 0 4px 4px #ffc3e9;
        background-color: #d885ae;
        color: #ffffff;
    }

    a.issue-ld-badge-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/badge-limited-duration-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #ebb0d5;
        color: #ffffff;
    }

    a.issue-std-badge-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/badge-standard-img.png' %}');
        background-color: #5484a8;
        color: #ffffff;
        font-size:1.1em;
    }

    a.issue-std-badge-panel:hover {
        -webkit-filter: brightness(105%);
        filter: brightness(105%);
        box-shadow: inset 0 0 4px 4px #88d0fa;
        background-color: #5d91b5;
        color: #ffffff;
    }

    a.issue-std-badge-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/badge-standard-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #7cbfea;
        background-color: #5484a8;
        color: #ffffff;
    }

    a.return-badge-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/return-img.png' %}');
        background-color: #7a9b79;
        color: #ffffff;
        font-size:1.1em;
    }

    a.return-badge-panel:hover {
        -webkit-filter: brightness(105%);
        filter: brightness(105%);
        box-shadow: inset 0 0 4px 4px #c6e8c5;
        background-color: #83a582;
        color: #ffffff;
    }

    a.return-badge-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/return-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #89a888;
        color: #ffffff;
    }

    a.search-name-panel:hover, a.search-date-panel:hover, a.search-badge-panel:hover  {
        -webkit-filter: brightness(105%);
        filter: brightness(105%);
        box-shadow: inset 0 0 4px 4px #c3c3c3;
        background-color: #9b9b9b;
        color: #ffffff;
    }

    a.search-name-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-person-img.png' %}');
        background-color: #919191;
        color: #ffffff;
    }

    a.search-name-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-person-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #a5a5a5;
        background-color: #919191;
        color: #ffffff;
    }

    a.search-badge-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-badge-img.png' %}');
        background-color: #919191;
        color: #ffffff;
    }

    a.search-badge-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-badge-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #a5a5a5;
        background-color: #919191;
        color: #ffffff;
    }

    a.search-date-panel {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-date-img.png' %}');
        background-color: #919191;
        color: #ffffff;
    }

    a.search-date-panel:active {
        background-image: url('{% static 'tbadge_portal/img/badge-icons/search-date-img.png' %}');
        -webkit-filter: brightness(100%);
        filter: brightness(100%);
        box-shadow: inset 0 0 4px 4px #a5a5a5;
        background-color: #919191;
        color: #ffffff;
    }

    </style>
{% endblock %}

{% block javascripts-before %}
    <script src="{% static 'tbadge_portal/confirm/js/jquery-confirm.js' %}"></script>
    <script src="{% static 'tbadge_portal/js/helpers.js' %}"></script>
{% endblock %}

{% block container %}
    {% if request.session.role == "Admin" %}

    <div class="header-group">
        <h1 class="page-title"><span>Home</span></h1>
        <hr class="header-line">
    </div>

    <!-- Admin Version -->
    <!-- Button Panels -->
    <div class="row container-fluid" style="margin-bottom:50px">

        <!-- Badge Actions -->
        <div class="col-lg-6 center">
            <div class="row">
                <h3>Badge Actions</h3>
                <span class="panel-margin">
                    <!--  href="{% url 'badge_issue' %}?type=ld" -->
                <a id = "ld_btn" class="btn btn-primary-panel btn-panel issue-ld-badge-panel">Issue Limited Duration</a>
                </span>
                <span class="panel-margin">
                    <!-- href="{% url 'badge_issue' %}?type=standard"  -->
                <a id = "std_btn" class="btn btn-primary-panel btn-panel issue-std-badge-panel">Issue Standard</a>
                </span>
                <span>
                <a href="{% url 'badge_return' %}" class="btn btn-primary-panel btn-panel return-badge-panel"> Return Badge </a>
                </span>
            </div>
        </div>

        <!--<span class = "vr col-md-1"></span>-->

        <!-- Search Actions -->
        <div class="col-lg-6 center">
            <div class="row">
            <h3>Search</h3>
            <span class="panel-margin">
                <a href = "{% url 'applicant_lookup' %}" class = "btn btn-primary-panel btn-panel search-name-panel">By Name</a>
            </span>
            <span class="panel-margin">
                <a href = "{% url 'badge_lookup' %}?type=id" class = "btn btn-primary-panel btn-panel search-badge-panel">By Badge ID</a>
            </span>
            <span class="panel-margin">
                <a href = "{% url 'badge_lookup' %}?type=date" class = "btn btn-primary-panel btn-panel search-date-panel">By Date Range</a>
            </span>
            </div>
        </div>
    </div>

    <!-- Recently Issued Table -->
    <h2 style="margin-top: 60px">Recently Issued Badges (Last 24 Hours)</h2>
    <hr>
     <table id= "recent_badges" cellspacing = "0" width = "100%" >
        <thead>
            <tr>
                <th>Card Serial Number (CSN)</th>
                <th>Badge Type</th>
                <th>Issued To</th>
                <th>Escorted By</th>
                <th>Issued By</th>
                <th>Issued On</th>
                <th>Due On</th>
            </tr>
        </thead>
    </table>
    <div>
        <a href = "{% url 'badge_list' %}?type=recent" id = "recent_badges_btn" class = "btn btn-primary btn-lg" style= "float: right; font-size: 1em; margin-top: 4px; margin-bottom: 100px">View All</a>
    </div>

    {% else %}
        <!--User Version-->
        <div class="vertical-center" style="margin-top: -425px">
        <div class="col-lg-6 col-lg-offset-3 center" style="margin-bottom: 15px">
            <h1 class="page-title"><span>Home</span></h1>
            <hr class="header-line">
        </div>
        <div class="col-lg-12 center">
            <span>
                <a id = "ld_btn" class = "btn btn-primary-panel btn-panel issue-ld-badge-panel" style="width:323px;height:555px">Issue Limited Duration</a>
            </span>
            <span style="margin-left:50px">
                <a href = "{% url 'badge_return' %}" class = "btn btn-primary-panel btn-panel return-badge-panel" style="width:323px;height:555px"> Return Badge </a>
            </span>
            <span style="margin-left:50px">
                <a href = "{% url 'badge_lookup' %}?type=id" class = "btn btn-primary-panel btn-panel search-badge-panel" style="width:323px;height:555px"> Lookup A Badge </a>
            </span>

       </div>
        </div>
    {% endif %}
{% endblock %}

{% block javascripts-after %}
    <script>
    $(function() {

        function confirmReminder(badgeType){
            $.confirm({
                columnClass: "col-md-6 col-md-offset-3",
                theme: "black",
                title: "Reminder",
                closeIcon: true,
                backgroundDismiss: true,
                content: "<p>Did the government ID pass the validation check?</p> <img src = '{% static 'tbadge_portal/img/badge-icons/validate_id_reminder.png' %}'></img>",
                confirmButton: "Yes",
                cancelButton: "No",
                confirmButtonClass:"btn-primary btn-xlg",
                cancelButtonClass:" btn-danger btn-xlg",
                keyboardEnabled: true,
                confirm: function() {
                    if(badgeType == "ld") window.location.href = "{% url 'badge_issue' %}?type=ld";
                    else if (badgeType == "std") window.location.href = "{% url 'badge_issue' %}?type=standard";
                }
            });
        };

        $('#ld_btn').click( function() { confirmReminder("ld");});
        $('#std_btn').click( function() { confirmReminder("std");});

        {% if request.session.role == "User" %}
            $('#container').css("margin", 0);
        {% endif %}
        var recent_badges = $('#recent_badges').DataTable( {
        dom: "t",
        bSort: false,
        responsive: true,
        pageLength: 3,
        ajax: {
            url: "{% url 'badge_list' %}?type=recent&f=json",
            dataSrc: "data"
        },
        columns: [
            { "data" : function(data) {
                var url = "{% url 'badge_view' "csnHolder" %}";
                url = url.replace("csnHolder", data.csn);
                return "<a href="+url+">"+data.csn+"</a>";
                }},
            { "data": "badge_type"},
                { "data" : function(data){
                    var url = "{% url 'applicant_view' "appIDHolder"%}";
                    url = url.replace("appIDHolder", intToHashid(data.applicant_id));
                    if (data.applicant_middle_name != null)
                        return "<a href="+url+">"+data.applicant_first_name + " " + data.applicant_middle_name + " " + data.applicant_last_name +"</a>";
                    return "<a href="+url+">"+data.applicant_first_name + " " + data.applicant_last_name +"</a>";
                }},
            { "data": function(data) {
                    if (data.badge_type == "Standard")
                        return "Not Applicable";
                    if (data.escort_first_name != null && data.escort_last_name != null) {
                        var url = "{% url 'badge_escort_csn_to_upid' %}?csn=" + data.escort_csn;
                        if (data.escort_middle_name != null)
                            return "<a href='" + url + "'>" + data.escort_first_name + " " + data.escort_middle_name + " " + data.escort_last_name + "</a>";
                        return "<a href='" + url + "'>" + data.escort_first_name + " " + data.escort_last_name + "</a>";
                    }
                    return "(Not on File)";
                }
            },
            { "data" : "issued_by"},
            { "data" : "issued_on"},
            { "data" : "due_on"}
        ],
        "language" : {
            "emptyTable": "No Recent Badges."
        }
        });
    });
    </script>
{% endblock %}